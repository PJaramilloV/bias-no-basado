filter(is_recid != -1) %>%
relocate(charge_desc = c_charge_desc)
View(jailhistory)
people_w_id <- people %>%
left_join(jailhistory %>%
select("first", "last", "dob", "person_id"),
by=c("first", "last", "dob"))
people_w_id <- people %>%
left_join(jailhistory %>%
distinct("first", "last", "dob", "person_id")
select("first", "last", "dob", "person_id"),
by=c("first", "last", "dob"))
people_w_id <- people %>%
left_join(jailhistory %>%
distinct("first", "last", "dob", "person_id") %>%
select("first", "last", "dob", "person_id"),
by=c("first", "last", "dob"))
people_w_id <- people %>%
left_join(jailhistory %>%
distinct(c("first", "last", "dob", "person_id")) %>%
select("first", "last", "dob", "person_id"),
by=c("first", "last", "dob"))
people_w_id <- people %>%
left_join(jailhistory %>%
distinct(first, last, dob, person_id) %>%
select("first", "last", "dob", "person_id"),
by=c("first", "last", "dob"))
people_charge <- charge %>%
left_join(people %>%
filter(is_recid != -1) %>%
select(name, race),
by=c("name", "dob")) %>%
distinct()
people_charge <- charge %>%
left_join(people %>%
filter(is_recid != -1) %>%
select(name, race),
by=c("person_id")) %>%
distinct()
View(people_w_id)
people_charge <- charge %>%
left_join(people_w_id %>%
filter(!(is.na(person_id))) %>%
select(name, race, person_id),
by=c("person_id")) %>%
distinct()
ids<- people_charge %>%
group_by(id) %>%
summarise(n=n()) %>% ungroup() %>%
filter(n>1) %>% pull(id)
people_charge %>%
filter(id %in% ids) %>%  View()
people_charge %>%
group_by(id) %>%
summarise(n=n()) %>% ungroup() %>%
filter(n>1)
View(people_charge)
ids
people_charge %>%
group_by(id) %>%
summarise(n=n())
people_charge %>%
group_by(id) %>%
summarise(n=n()) %>% ungroup() %>%
filter(n>1)
people_charge %>%
filter(id %in% ids) %>%  View()
people_charge <- charge %>%
left_join(people_w_id %>%
filter(is_recid != -1) %>%
filter(!(is.na(person_id))) %>%
select(name, race, person_id),
by=c("person_id")) %>%
distinct()
rm(ids)
View(people_charge)
# tabla de los crimenes con razas appendadas
# is_recid != 1 es filtro para alejandro cabrera a quien se le adjudico la raza
#                 erronea en su primer arresto
# filtro para id's <NA> es porque no cometieron crimenes y por lo tanto no aparecen en jailhistory/charge
people_charge <- charge %>%
left_join(people_w_id %>%
filter(is_recid != -1) %>%
filter(!(is.na(person_id))) %>%
select(race, person_id),
by=c("person_id")) %>%
distinct()
View(people_charge)
# pregunta:
#     Los cargos sospechosamente leves, y/o ambiguos son repartidos con bias racial?
# insight:
#
people_charge %>%
filter(charge %in% flimsy_charges) %>%
ggplot(aes(x=race, fill=race)) +
geom_bar()
# Lista de cargos sospechosos compilada a mano
flimsy_charges = c("Infraction", "Municipal (Speed Not Indicated)",
"Speeding (Speed not Indicated)",
"Speeding (Speed Not Indicated)",
"Unlawful Speed / Speed Not Indicated", "Loitering", NA
)
# pregunta:
#     Los cargos sospechosamente leves, y/o ambiguos son repartidos con bias racial?
# insight:
#
people_charge %>%
filter(charge %in% flimsy_charges) %>%
ggplot(aes(x=race, fill=race)) +
geom_bar()
View(people_w_id)
# pregunta:
#     Los cargos sospechosamente leves, y/o ambiguos son repartidos con bias racial?
# insight:
#
people_charge %>%
filter(charge %in% flimsy_charges) %>%
filter(race=="Asian")
# pregunta:
#     Los cargos sospechosamente leves, y/o ambiguos son repartidos con bias racial?
# insight:
#
people_charge %>%
filter(charge %in% flimsy_charges) %>%
filter(race==NA)
# pregunta:
#     Los cargos sospechosamente leves, y/o ambiguos son repartidos con bias racial?
# insight:
#
people_charge %>%
filter(charge %in% flimsy_charges) %>%
filter(is.na(race))
View(people)
View(jailhistory)
View(casearrest)
View(compas)
View(casearrest)
View(prisonhistory)
people_w_id <- people %>%
left_join(jailhistory %>%
distinct(first, last, dob, person_id) %>%
select("first", "last", "dob", "person_id"),
by=c("first", "last", "dob")) %>%
left_join(prisonhistory %>%  distinct(first, last, dob, person_id) %>%
select("first", "last", "dob", "person_id"),
by=c("first", "last", "dob"))
people_w_id %>% filter(is.na(person_id.x))
people_w_id %>% filter(is.na(person_id.y))
people_w_id %>% filter(is.na(person_id.y)) %>% filter(is.na(person_id.x))
people_w_id %>% filter(is.na(person_id.y)) %>% filter(is.na(person_id.x)) %>% filter(is_recid != -1)
people_w_id %>% filter(!is.na(person_id.y)) %>% filter(!is.na(person_id.x)) %>% filter(is_recid != -1) %>% filter(person_id.x != person_id.y)
people_w_id %>% filter(!is.na(person_id.y)) %>% filter(!is.na(person_id.x)) %>% filter(is_recid != -1) %>% filter(person_id.x == person_id.y)
people_w_id <- people %>%
left_join(jailhistory %>%
distinct(first, last, dob, person_id) %>%
select("first", "last", "dob", "person_id"),
by=c("first", "last", "dob"))
people_w_id %>% filter(is.na(person_id))
# tabla de personas con sus IDs
people_w_id <- people %>%
left_join(prisonhistory %>%
distinct(first, last, dob, person_id) %>%
select("first", "last", "dob", "person_id"),
by=c("first", "last", "dob")) #%>%
people_w_id %>% filter(is.na(person_id))
people_w_id %>% filter(is.na(person_id.y)) %>% filter(is.na(person_id.x))
# tabla de personas con sus IDs
people_w_id <- people %>%
left_join(jailhistory %>%
distinct(first, last, dob, person_id) %>%
select("first", "last", "dob", "person_id"),
by=c("first", "last", "dob")) #%>%
people_w_id %>% filter(is.na(person_id.y)) %>% filter(is.na(person_id.x))
View(people_w_id)
people_w_id %>% filter(is.na(person_id))
# tabla de personas con sus IDs
people_w_id <- people %>%
left_join(jailhistory %>%
distinct(first, last, dob, person_id) %>%
select("first", "last", "dob", "person_id"),
by=c("first", "last", "dob")) %>%
left_join(prisonhistory %>%  distinct(first, last, dob, person_id) %>%
select("first", "last", "dob", "person_id"),
by=c("first", "last", "dob"))
people_w_id %>% filter(is.na(person_id.y)) %>% filter(is.na(person_id.x))
people_w_id <- people %>%
left_join(jailhistory %>%
distinct(first, last, dob, person_id) %>%
select("first", "last", "dob", "person_id"),
by=c("first", "last", "dob")) %>%
left_join(prisonhistory %>%  distinct(first, last, dob, person_id) %>%
select("first", "last", "dob", "person_id"),
by=c("first", "last", "dob")) %>%
mutate(person_id.x = ifelse(is.na(person_id.x), person_id.y, person_id.x)) %>%
relocate(person_id = person_id.x) %>%
select(-person_id.y)
View(people_w_id)
people_w_id %>% filter(is.na(person_id))
people_w_id %>% filter(person_id != id) %>%
# tabla de los crimenes con razas appendadas
# is_recid != 1 es filtro para alejandro cabrera a quien se le adjudico la raza
#                 erronea en su primer arresto
# filtro para id's <NA> es porque no cometieron crimenes y por lo tanto no aparecen en jailhistory/charge
people_charge <- charge %>%
left_join(people_w_id %>%
filter(is_recid != -1) %>%
filter(!(is.na(person_id))) %>%
select(race, person_id),
by=c("person_id")) %>%
distinct()
people_w_id %>% filter(person_id != id)
people_w_id %>% filter(is_recid != -1)
people_w_id %>% filter(person_id == id)
people_w_id %>% filter((person_id != id)||is.na(person_id))
people_w_id %>% filter((person_id != id) | is.na(person_id))
people_w_id %>% filter((person_id != id) | is.na(person_id)) %>% filter(is_recid != -1)
people_w_id %>% filter((person_id != id) | is.na(person_id)) %>% filter(is_recid != -1) %>% View()
people_w_id %>% filter((person_id != id) | is.na(person_id)) %>% filter(is_recid != -1)
people_w_id %>% filter((person_id != id) | is.na(person_id)) %>% filter(is_recid != -1) %>% filter(is.na(person_id))
people_w_id %>% filter((person_id != id) | is.na(person_id)) %>% filter(is.na(person_id))
people_w_id %>% filter((person_id != id) | is.na(person_id))
people %>%
left_join(jailhistory %>%
distinct(first, last, dob, person_id) %>%
select("first", "last", "dob", "person_id"),
by=c("first", "last", "dob")) %>%
left_join(prisonhistory %>%  distinct(first, last, dob, person_id) %>%
select("first", "last", "dob", "person_id"),
by=c("first", "last", "dob")) %>%
mutate(person_id.x = ifelse(is.na(person_id.x), person_id.y, person_id.x)) %>%
relocate(person_id = person_id.x) %>%
select(-person_id.y) %>%
filter(person_id == id)
people %>%
left_join(jailhistory %>%
distinct(first, last, dob, person_id) %>%
select("first", "last", "dob", "person_id"),
by=c("first", "last", "dob")) %>%
left_join(prisonhistory %>%  distinct(first, last, dob, person_id) %>%
select("first", "last", "dob", "person_id"),
by=c("first", "last", "dob")) %>%
mutate(person_id.x = ifelse(is.na(person_id.x), person_id.y, person_id.x)) %>%
relocate(person_id = person_id.x) %>%
select(-person_id.y) %>%
filter(person_id != id)
# tabla de personas con sus IDs
# se cruzan las tablas de historia carcelaria (jail) y penal (prison) para enlazar
# los id's de las personas con su nombre completo y fecha de nacimiento
#     se filtran person_id != id, pues son personas que aparecen duplicadas
#
people_w_id <- people %>%
left_join(jailhistory %>%
distinct(first, last, dob, person_id) %>%
select("first", "last", "dob", "person_id"),
by=c("first", "last", "dob")) %>%
left_join(prisonhistory %>%  distinct(first, last, dob, person_id) %>%
select("first", "last", "dob", "person_id"),
by=c("first", "last", "dob")) %>%
mutate(person_id.x = ifelse(is.na(person_id.x), person_id.y, person_id.x)) %>%
relocate(person_id = person_id.x) %>%
select(-person_id.y) %>%
filter(person_id != id)
# tabla de personas con sus IDs
# se cruzan las tablas de historia carcelaria (jail) y penal (prison) para enlazar
# los id's de las personas con su nombre completo y fecha de nacimiento
#     se filtran person_id != id, pues son personas que aparecen duplicadas
#
people_w_id <- people %>%
left_join(jailhistory %>%
distinct(first, last, dob, person_id) %>%
select("first", "last", "dob", "person_id"),
by=c("first", "last", "dob")) %>%
left_join(prisonhistory %>%  distinct(first, last, dob, person_id) %>%
select("first", "last", "dob", "person_id"),
by=c("first", "last", "dob")) %>%
mutate(person_id.x = ifelse(is.na(person_id.x), person_id.y, person_id.x)) %>%
relocate(person_id = person_id.x) %>%
select(-person_id.y) %>%
filter(!(person_id != id))
# tabla de personas con sus IDs
# se cruzan las tablas de historia carcelaria (jail) y penal (prison) para enlazar
# los id's de las personas con su nombre completo y fecha de nacimiento
#     se filtran person_id != id, pues son personas que aparecen duplicadas
#
people_w_id <- people %>%
left_join(jailhistory %>%
distinct(first, last, dob, person_id) %>%
select("first", "last", "dob", "person_id"),
by=c("first", "last", "dob")) %>%
left_join(prisonhistory %>%  distinct(first, last, dob, person_id) %>%
select("first", "last", "dob", "person_id"),
by=c("first", "last", "dob")) %>%
mutate(person_id.x = ifelse(is.na(person_id.x), person_id.y, person_id.x)) %>%
relocate(person_id = person_id.x) %>%
select(-person_id.y) %>%
filter(person_id == id | is.na(person_id))
people_w_id %>% filter( is.na(person_id))
people_w_id %>% filter( !is.na(person_id)) %>% filter(is_recid != -1)
people_w_id %>% filter( is.na(person_id))
people_w_id %>% filter(! is.na(person_id)) %>% filter(is_recid != -1)
people_w_id %>% filter(! is.na(person_id))
people_w_id %>% filter(! is.na(person_id)) %>% filter(is_recid != -1)
people_w_id %>% filter(! is.na(person_id)) %>% filter(is_recid == -1)
people_w_id %>% filter( is.na(person_id)) %>% filter(is_recid == -1)
View(casearrest)
View(charge)
people_w_id %>% filter( is.na(person_id)) %>% filter(is_recid != -1)
people_w_id %>%
mutate(person_id = ifelse(is.na(person_id), id, person_id)) %>%
group_by(name, dob) %>%
summarise(n=n()) %>%
arrange(desc(n))
people %>%
group_by(name, dob) %>%
summarise(n=n()) %>%
arrange(desc(n))
# tabla de personas con sus IDs
# se cruzan las tablas de historia carcelaria (jail) y penal (prison) para enlazar
# los id's de las personas con su nombre completo y fecha de nacimiento
#     se filtran person_id != id, pues son personas que aparecen duplicadas (3 personas)
#       con esos valores eliminados se puede copiar el id al person id pues son identicos
#       entonces se tiene una tabla que enlaza unicamente a una persona con 1 id
#       para asi cruzar esta tabla con tablas de arresto para graficar segun raza
people_w_id <- people %>%
left_join(jailhistory %>%
distinct(first, last, dob, person_id) %>%
select("first", "last", "dob", "person_id"),
by=c("first", "last", "dob")) %>%
left_join(prisonhistory %>%  distinct(first, last, dob, person_id) %>%
select("first", "last", "dob", "person_id"),
by=c("first", "last", "dob")) %>%
mutate(person_id.x = ifelse(is.na(person_id.x), person_id.y, person_id.x)) %>%
relocate(person_id = person_id.x) %>%
select(-person_id.y) %>%
filter(person_id == id | is.na(person_id)) %>%
mutate(person_id = ifelse(is.na(person_id), id, person_id))
# tabla de los crimenes con razas appendadas
# is_recid != 1 es filtro para alejandro cabrera a quien se le adjudico la raza
#                 erronea en su primer arresto
# filtro para id's <NA> es porque no cometieron crimenes y por lo tanto no aparecen en jailhistory/charge
people_charge <- charge %>%
left_join(people_w_id %>%
filter(is_recid != -1) %>%
filter(!(is.na(person_id))) %>%
select(race, person_id),
by=c("person_id")) %>%
distinct()
ggplot(aes(x=race, fill=race)) +
geom_bar()
# pregunta:
#     Los cargos sospechosamente leves, y/o ambiguos son repartidos con bias racial?
# insight:
#
people_charge %>%
filter(charge %in% flimsy_charges) %>%
ggplot(aes(x=race, fill=race)) +
geom_bar()
# pregunta:
#     Los cargos sospechosamente leves, y/o ambiguos son repartidos con bias racial?
# insight:
#
people_charge %>%
ggplot(aes(x=race, fill=race)) +
geom_bar() +
facet_wrap(~ (charge %in% flimsy_charges))
# pregunta:
#     Los cargos sospechosamente leves, y/o ambiguos son repartidos con bias racial?
# insight:
#
people_charge %>%
ggplot(aes(x=race, fill=race)) +
geom_bar() +
facet_wrap(~ (charge %in% flimsy_charges), scales="free_y")
# pregunta:
#     Los cargos sospechosamente leves, y/o ambiguos son repartidos con bias racial?
# insight:
#
people_charge %>%
ggplot(aes(x=race, fill=race)) +
geom_bar() +
facet_wrap(~ !(charge %in% flimsy_charges), scales="free_y",
labeller=as_labeller(
c(`FALSE` = "Flimsy charges", `TRUE` = "Other charges")))
people_charge %>% filter(is.na(race))
View(people)
View(people_w_id)
# tabla de los crimenes con razas appendadas
# is_recid != 1 es filtro para alejandro cabrera a quien se le adjudico la raza
#                 erronea en su primer arresto
# filtro para id's <NA> es porque no cometieron crimenes y por lo tanto no aparecen en jailhistory/charge
people_charge <- charge %>%
left_join(people_w_id %>%
filter(is_recid != -1) %>%
filter(!(is.na(person_id))) %>%
select(race, person_id),
by=c("person_id")) %>%
distinct()
people_charge %>% filter(is.na(race))
# tabla de los crimenes con razas appendadas
# is_recid != 1 es filtro para alejandro cabrera a quien se le adjudico la raza
#                 erronea en su primer arresto
# filtro para id's <NA> es porque no cometieron crimenes y por lo tanto no aparecen en jailhistory/charge
people_charge <- charge %>%
left_join(people_w_id %>%
filter(!(is.na(person_id))) %>%
select(race, person_id),
by=c("person_id")) %>%
distinct()
people_charge %>% filter(is.na(race))
people_charge %>% filter(name == "alejandro cabrera")
# tabla de los crimenes con razas appendadas
# filtro para id's <NA> es porque no cometieron crimenes y por lo tanto no aparecen en jailhistory/charge
people_charge <- charge %>%
left_join(people_w_id %>%
select(race, person_id),
by=c("person_id")) %>%
distinct()
# pregunta:
#     Los cargos sospechosamente leves, y/o ambiguos son repartidos con bias racial?
# insight:
#
people_charge %>%
ggplot(aes(x=race, fill=race)) +
geom_bar() +
facet_wrap(~ !(charge %in% flimsy_charges), scales="free_y",
labeller=as_labeller(
c(`FALSE` = "Flimsy charges", `TRUE` = "Other charges")))+
theme(legend.position = "none", axis.text.x = element_text(angle=15, vjust=0.9, hjust=0.55))
# pregunta:
#     Los cargos sospechosamente leves, y/o ambiguos son repartidos con bias racial?
# insight:
#
people_charge %>%
group_by(race) %>%
mutate(count = n()) %>%
ggplot(aes(x=reorder(race, -count), fill=race)) +
geom_bar() +
facet_wrap(~ !(charge %in% flimsy_charges), scales="free_y",
labeller=as_labeller(
c(`FALSE` = "Flimsy charges", `TRUE` = "Other charges")))+
theme(legend.position = "none", axis.text.x = element_text(angle=15, vjust=0.9, hjust=0.55))
# pregunta:
#     Los cargos sospechosamente leves, y/o ambiguos son repartidos con bias racial?
# insight:
#
people_charge %>%
group_by(race) %>%
mutate(count = n()) %>%
ggplot(aes(x=reorder(race, -count), fill=race)) +
geom_bar() +
facet_wrap(~ !(charge %in% flimsy_charges), scales="free_y",
labeller=as_labeller(
c(`FALSE` = "Flimsy charges", `TRUE` = "Other charges"))) +
labs(title="Number of arrests by race with flimsy charges compared to other cases",
x="Race", y="Number of arrests") +
theme(legend.position = "none", axis.text.x = element_text(angle=15, vjust=0.9, hjust=0.55))
View(charge)
View(casearrest)
View(charge)
View(compas)
View(jailhistory)
View(prisonhistory)
View(people)
# tabla de personas con sus IDs
# se cruzan las tablas de historia carcelaria (jail) y penal (prison) para enlazar
# los id's de las personas con su nombre completo y fecha de nacimiento
#     se filtran person_id != id, pues son personas que aparecen duplicadas (3 personas)
#       con esos valores eliminados se puede copiar el id al person id pues son identicos
#       entonces se tiene una tabla que enlaza unicamente a una persona con 1 id
#       para asi cruzar esta tabla con tablas de arresto para graficar segun raza
people_partial_id <- people %>%
left_join(jailhistory %>%
distinct(first, last, dob, person_id) %>%
select("first", "last", "dob", "person_id"),
by=c("first", "last", "dob")) %>%
left_join(prisonhistory %>%  distinct(first, last, dob, person_id) %>%
select("first", "last", "dob", "person_id"),
by=c("first", "last", "dob")) %>%
mutate(person_id.x = ifelse(is.na(person_id.x), person_id.y, person_id.x)) %>%
relocate(person_id = person_id.x) %>%
select(-person_id.y) %>%
filter(person_id == id | is.na(person_id))
people_w_id <- people_partial_id %>%
mutate(person_id = ifelse(is.na(person_id), id, person_id))
# la gente que no tiene person_id es porque no estaban en jailhistory/prisonhistory
people_not_sentenced <- people_partial_id %>%
filter(is.na(person_id))
# pregunta:
#     De la gente que no fue a prision o carcel, como se distribuyen?
# insight:
#
people_not_sentenced %>%
group_by(race) %>%
mutate(count = n()) %>%
ggplot(aes(x=reorder(race, -count), fill=race)) +
geom_bar()
# pregunta:
#     De la gente que no fue a prision o carcel, como se distribuyen?
# insight:
#
people_partial_id %>%
group_by(race) %>%
mutate(count = n()) %>%
ggplot(aes(x=reorder(race, -count), fill=race)) +
geom_bar() +
facet_wrap(~ is.na(person_id), scales="free_y",
labeller=as_labeller(
c(`TRUE` = "Not sent to jail/prison", `FALSE` = "Sent to jail/prison"))
) +
labs(title="Race by whether people were sent to jail or prison",
x="Race", y="Number of people") +
theme(legend.position = "none", axis.text.x = element_text(angle=15, vjust=0.9, hjust=0.55))
